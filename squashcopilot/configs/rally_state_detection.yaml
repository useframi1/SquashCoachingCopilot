# Rally State Detection Configuration

# LSTM Inference Configuration
inference:
    # Detection method (currently only lstm supported)
    method: lstm

    # Path to trained LSTM model weights (relative to project root)
    model_path: squashcopilot/modules/rally_state_detection/model/weights/rally_state_lstm_best.pt

    # Post-processing parameters
    min_segment_length: 120 # Minimum frames for a valid rally segment
    merge_gap_threshold: 60 # Merge segments separated by fewer than this many frames

annotation:
    # Video name to annotate (will look for files in annotations_dir/{video_name}/)
    video_name: video-5

    # Directory containing annotation data (CSV files with features)
    annotations_dir: squashcopilot/annotation/annotations

    # Directory containing video files
    video_dir: squashcopilot/videos

    # Output directory for annotated CSV files
    output_dir: squashcopilot/modules/rally_state_detection/tests/data

    # Features to extract from CSV (column names)
    # These features will be included in the output annotated CSV
    features:
        - ball_y # Y coordinate of ball position
        - player_1_x_meter # X coordinate of player 1 in meters
        - player_1_y_meter # Y coordinate of player 1 in meters
        - player_2_x_meter # X coordinate of player 2 in meters
        - player_2_y_meter # Y coordinate of player 2 in meters

    # Label column name in output CSV
    label_column: rally_state

    # Possible label values
    labels:
        start: start
        end: end

# LSTM Training Configuration
training:
    # Directory containing annotated CSV files for training
    data_dir: squashcopilot/modules/rally_state_detection/tests/data
    # annotations_dir: squashcopilot/annotation/annotations

    # Features to use for training (must exist in CSV files)
    features:
        - ball_y # Y coordinate of ball position
        - player_1_x_meter # X coordinate of player 1 in meters
        - player_1_y_meter # Y coordinate of player 1 in meters
        - player_2_x_meter # X coordinate of player 2 in meters
        - player_2_y_meter # Y coordinate of player 2 in meters

    # Label column name in CSV files
    label_column: rally_state

    # Label mapping (start = rally active = 1, end = rally inactive = 0)
    labels:
        start: 1
        end: 0

    # Sequence parameters
    sequence_length: 180 # Number of frames in each sequence

    # Data splitting
    train_test_split: 0.8 # Ratio of videos for training vs testing
    validation_split: 0.2 # Ratio of training data for validation (0 = no validation)

    # Training hyperparameters
    batch_size: 32
    epochs: 100
    learning_rate: 0.001

    # Early stopping configuration
    early_stopping:
        enabled: true # Enable early stopping
        patience: 10 # Number of epochs to wait for improvement
        min_delta: 0.0001 # Minimum change to qualify as improvement

    # Performance settings
    num_threads: 8 # Number of threads for CPU training (null = use all cores)
    num_workers: 0 # Number of worker processes for data loading (0 = main process only)

    # Model architecture
    model:
        hidden_size: 128 # LSTM hidden layer size
        num_layers: 2 # Number of stacked LSTM layers
        dropout: 0.2 # Dropout rate for regularization
        bidirectional: true # Use bidirectional LSTM

    # Model saving
    model_save_path: squashcopilot/modules/rally_state_detection/models/weights
    checkpoint_name: rally_state_lstm.pt

tests:
    # Video name to evaluate
    video_name: video-5

    # Directory containing annotated CSV files
    data_dir: squashcopilot/modules/rally_state_detection/tests/data

    # Directory containing video files
    video_dir: squashcopilot/videos

    # Output directory for plots and results
    output_dir: squashcopilot/modules/rally_state_detection/tests/outputs

    # Tolerance for boundary matching (in frames)
    # A predicted boundary within +/- tolerance of ground truth is considered correct
    boundary_tolerance: 60
